(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5335],{3456:(e,t,r)=>{"use strict";r.d(t,{DX:()=>u,TL:()=>d});var a,s=r(21555),n=r(24103),l=r(55155),i=Symbol.for("react.lazy"),o=(a||(a=r.t(s,2)))[" use ".trim().toString()];function c(e){var t;return null!=e&&"object"==typeof e&&"$$typeof"in e&&e.$$typeof===i&&"_payload"in e&&"object"==typeof(t=e._payload)&&null!==t&&"then"in t}function d(e){var t;let r,a=(t=e,(r=s.forwardRef((e,t)=>{let{children:r,...a}=e;if(c(r)&&"function"==typeof o&&(r=o(r._payload)),s.isValidElement(r)){var l;let e,i,o=(l=r,(i=(e=Object.getOwnPropertyDescriptor(l.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?l.ref:(i=(e=Object.getOwnPropertyDescriptor(l,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?l.props.ref:l.props.ref||l.ref),c=function(e,t){let r={...t};for(let a in t){let s=e[a],n=t[a];/^on[A-Z]/.test(a)?s&&n?r[a]=(...e)=>{let t=n(...e);return s(...e),t}:s&&(r[a]=s):"style"===a?r[a]={...s,...n}:"className"===a&&(r[a]=[s,n].filter(Boolean).join(" "))}return{...e,...r}}(a,r.props);return r.type!==s.Fragment&&(c.ref=t?(0,n.t)(t,o):o),s.cloneElement(r,c)}return s.Children.count(r)>1?s.Children.only(null):null})).displayName=`${t}.SlotClone`,r),i=s.forwardRef((e,t)=>{let{children:r,...n}=e;c(r)&&"function"==typeof o&&(r=o(r._payload));let i=s.Children.toArray(r),d=i.find(p);if(d){let e=d.props.children,r=i.map(t=>t!==d?t:s.Children.count(e)>1?s.Children.only(null):s.isValidElement(e)?e.props.children:null);return(0,l.jsx)(a,{...n,ref:t,children:s.isValidElement(e)?s.cloneElement(e,void 0,r):null})}return(0,l.jsx)(a,{...n,ref:t,children:r})});return i.displayName=`${e}.Slot`,i}var u=d("Slot"),m=Symbol("radix.slottable");function p(e){return s.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===m}},11428:(e,t,r)=>{"use strict";r.d(t,{H:()=>n,h:()=>l});var a=r(21555),s=r(15885);function n(){let[e,t]=(0,a.useState)(null),[r,n]=(0,a.useState)(!0),[l,i]=(0,a.useState)(null),[o,c]=(0,a.useState)(!1),d=(0,a.useCallback)(async()=>{try{n(!0),i(null);let e=await s.api.getFamilyGroup();t(e)}catch(e){console.error("[useFamilyGroup] Failed to fetch group:",e),i(e instanceof Error?e:Error("Failed to fetch family group"))}finally{n(!1)}},[]);(0,a.useEffect)(()=>{d()},[d]);let u=(0,a.useMemo)(()=>{if(!e?.memberGroup)return null;let t=e.memberGroup;return{id:t.id,name:t.name,inviteCode:t.invite_code,status:t.status,createdAt:t.created_at,members:t.members.map(e=>({id:e.id,userId:e.user_id,role:e.role,joinedAt:e.joined_at,displayName:e.user.display_name,avatarUrl:e.user.avatar_url})),permissions:t.permissions,pendingInvitations:t.pendingInvitations.map(e=>({id:e.id,email:e.email,role:e.role,expiresAt:e.expires_at,inviteToken:e.invite_token}))}},[e]),m=(0,a.useMemo)(()=>e?.visitorGroups?e.visitorGroups.map(e=>({id:e.id,name:e.name,role:"visitor",joinedAt:e.joined_at})):[],[e]),p=e?.userRole||null,f=!!u,h=(0,a.useCallback)(async e=>{try{return c(!0),await s.api.createFamilyGroup(e),await d(),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to create group"}}finally{c(!1)}},[d]),x=(0,a.useCallback)(async e=>{if(!u)return{success:!1,error:"No group found"};try{return c(!0),await s.api.updateFamilyGroup(u.id,e),await d(),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to update group"}}finally{c(!1)}},[u,d]),g=(0,a.useCallback)(async()=>{if(!u)return{success:!1,error:"No group found"};try{return c(!0),await s.api.deleteFamilyGroup(u.id,!0),await d(),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to delete group"}}finally{c(!1)}},[u,d]),v=(0,a.useCallback)(async(e,t)=>{if(!u)return{success:!1,error:"No group found"};try{c(!0);let r=await s.api.inviteFamilyMember(u.id,e,t);return await d(),{success:!0,inviteLink:r.inviteLink}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to invite member"}}finally{c(!1)}},[u,d]),b=(0,a.useCallback)(async e=>{if(!u)return{success:!1,error:"No group found"};try{return c(!0),await s.api.removeFamilyMember(u.id,e),await d(),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to remove member"}}finally{c(!1)}},[u,d]),y=(0,a.useCallback)(async(e,t)=>{if(!u)return{success:!1,error:"No group found"};try{return c(!0),await s.api.updateMemberRole(u.id,e,t),await d(),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to update role"}}finally{c(!1)}},[u,d]),k=(0,a.useCallback)(async e=>{let t=e||u?.id;if(!t)return{success:!1,error:"No group found"};try{return c(!0),await s.api.leaveFamilyGroup(t,!0),await d(),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to leave group"}}finally{c(!1)}},[u,d]),j=(0,a.useCallback)(()=>u?.members.filter(e=>"owner"===e.role)||[],[u]),N=(0,a.useCallback)(()=>u?.members.filter(e=>"member"===e.role)||[],[u]),w=(0,a.useCallback)(()=>u?.members.filter(e=>"visitor"===e.role)||[],[u]),C=u?.status==="grace_period",S=u?.status==="frozen",_=u?.status==="active";return{group:u,visitorGroups:m,userRole:p,isOwner:"owner"===p,isMember:"member"===p,isVisitor:"visitor"===p,hasGroup:f,isActive:_,isGracePeriod:C,isFrozen:S,loading:r,actionLoading:o,error:l,refresh:d,createGroup:h,updateGroup:x,deleteGroup:g,inviteMember:v,removeMember:b,updateRole:y,leaveGroup:k,getOwners:j,getMembers:N,getVisitors:w,ownerCount:j().length,memberCount:N().length,visitorCount:w().length,totalMembers:u?.members.length||0,pendingInvitationsCount:u?.pendingInvitations.length||0}}function l(){let[e,t]=(0,a.useState)(!1),[r,n]=(0,a.useState)(null);return{acceptInvite:(0,a.useCallback)(async e=>{try{t(!0),n(null);let r=await s.api.acceptFamilyInvite(e);return{success:!0,groupName:r.group.name,role:r.role}}catch(t){let e=t instanceof Error?t.message:"Failed to accept invitation";return n(t instanceof Error?t:Error(e)),{success:!1,error:e}}finally{t(!1)}},[]),loading:e,error:r}}},18546:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(18889).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},24103:(e,t,r)=>{"use strict";r.d(t,{s:()=>l,t:()=>n});var a=r(21555);function s(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function n(...e){return t=>{let r=!1,a=e.map(e=>{let a=s(e,t);return r||"function"!=typeof a||(r=!0),a});if(r)return()=>{for(let t=0;t<a.length;t++){let r=a[t];"function"==typeof r?r():s(e[t],null)}}}}function l(...e){return a.useCallback(n(...e),e)}},31616:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var a=r(43696),s=r(33086);function n(...e){return(0,s.QP)((0,a.$)(e))}},33971:(e,t,r)=>{"use strict";r.d(t,{$:()=>o,r:()=>i});var a=r(55155),s=r(3456),n=r(47426),l=r(31616);let i=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-bold transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:ring-2 focus-visible:ring-orange-500 focus-visible:ring-offset-2",{variants:{variant:{default:"bg-orange-500 text-white hover:bg-orange-600 shadow-md shadow-orange-200 dark:shadow-orange-900/20",destructive:"bg-red-500 text-white hover:bg-red-600 shadow-md shadow-red-200 dark:shadow-red-900/20",outline:"border-2 border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-900 dark:text-white hover:bg-slate-50 dark:hover:bg-slate-800 hover:border-slate-300 dark:hover:border-slate-600",secondary:"bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-white hover:bg-slate-200 dark:hover:bg-slate-700",ghost:"hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-900 dark:text-white",link:"text-orange-500 dark:text-orange-400 underline-offset-4 hover:underline"},size:{default:"h-11 px-5 py-2",sm:"h-9 rounded-lg px-3 text-xs",lg:"h-14 rounded-2xl px-8 text-base",icon:"size-10"}},defaultVariants:{variant:"default",size:"default"}});function o({className:e,variant:t,size:r,asChild:n=!1,...o}){let c=n?s.DX:"button";return(0,a.jsx)(c,{"data-slot":"button",className:(0,l.cn)(i({variant:t,size:r,className:e})),...o})}},43131:(e,t,r)=>{Promise.resolve().then(r.bind(r,99212))},47426:(e,t,r)=>{"use strict";r.d(t,{F:()=>l});var a=r(43696);let s=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,n=a.$,l=(e,t)=>r=>{var a;if((null==t?void 0:t.variants)==null)return n(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:l,defaultVariants:i}=t,o=Object.keys(l).map(e=>{let t=null==r?void 0:r[e],a=null==i?void 0:i[e];if(null===t)return null;let n=s(t)||s(a);return l[e][n]}),c=r&&Object.entries(r).reduce((e,t)=>{let[r,a]=t;return void 0===a||(e[r]=a),e},{});return n(e,o,null==t||null==(a=t.compoundVariants)?void 0:a.reduce((e,t)=>{let{class:r,className:a,...s}=t;return Object.entries(s).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...i,...c}[t]):({...i,...c})[t]===r})?[...e,r,a]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}},50497:(e,t,r)=>{"use strict";var a=r(60685);r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},57809:(e,t,r)=>{"use strict";r.d(t,{BT:()=>o,Wu:()=>c,ZB:()=>i,Zp:()=>n,aR:()=>l});var a=r(55155),s=r(31616);function n({className:e,...t}){return(0,a.jsx)("div",{"data-slot":"card",className:(0,s.cn)("bg-white dark:bg-slate-900 text-slate-900 dark:text-white flex flex-col gap-6 rounded-2xl border border-slate-200 dark:border-slate-800 py-6 shadow-sm",e),...t})}function l({className:e,...t}){return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,s.cn)("flex flex-col gap-1.5 px-6",e),...t})}function i({className:e,...t}){return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,s.cn)("leading-none font-bold tracking-tight text-xl",e),...t})}function o({className:e,...t}){return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,s.cn)("text-slate-600 dark:text-slate-400 text-sm",e),...t})}function c({className:e,...t}){return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,s.cn)("px-6",e),...t})}},67649:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(18889).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},78562:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(18889).A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},99212:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var a=r(55155),s=r(21555),n=r(50497),l=r(3948),i=r.n(l),o=r(18546),c=r(67649);let d=(0,r(18889).A)("log-in",[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]]);var u=r(78562),m=r(57809),p=r(33971),f=r(11428),h=r(15885);function x(){let e=(0,n.useRouter)(),t=(0,n.useSearchParams)().get("token"),{acceptInvite:r,loading:l}=(0,f.h)(),[x,g]=(0,s.useState)("loading"),[v,b]=(0,s.useState)(!1),[y,k]=(0,s.useState)(null),[j,N]=(0,s.useState)(null);(0,s.useEffect)(()=>{t?(async()=>{try{let{data:{session:e}}=await h.api.getSession();e?(b(!0),g("ready")):(b(!1),g("unauthenticated"))}catch{g("unauthenticated")}})():g("no-token")},[t]);let w=async()=>{if(!t)return;let e=await r(t);e.success?(k({groupName:e.groupName,role:e.role}),g("success")):(N(e.error||"Failed to accept invitation"),g("error"))};return(0,s.useEffect)(()=>{if(v&&t){let e=sessionStorage.getItem("pendingInviteToken");e&&e===t&&(sessionStorage.removeItem("pendingInviteToken"),w())}},[v,t]),(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 flex items-center justify-center p-4",children:(0,a.jsxs)(m.Zp,{className:"w-full max-w-md",children:[(0,a.jsxs)(m.aR,{className:"text-center",children:[(0,a.jsx)("div",{className:"mx-auto w-16 h-16 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center mb-4",children:(0,a.jsx)(o.A,{className:"h-8 w-8 text-orange-500"})}),(0,a.jsx)(m.ZB,{children:"Family Group Invitation"}),(0,a.jsx)(m.BT,{children:"You've been invited to join a family group."})]}),(0,a.jsxs)(m.Wu,{children:["no-token"===x&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-4 rounded-xl bg-red-50 dark:bg-red-900/20 text-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-3",children:(0,a.jsx)(c.A,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),(0,a.jsx)("p",{className:"font-medium text-red-700 dark:text-red-400",children:"Invalid Invitation Link"}),(0,a.jsx)("p",{className:"text-sm text-red-600 dark:text-red-500 mt-1",children:"This invitation link is missing a token."})]}),(0,a.jsx)(p.$,{className:"w-full",asChild:!0,children:(0,a.jsx)(i(),{href:"/",children:"Go Home"})})]}),"loading"===x&&(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto"}),(0,a.jsx)("p",{className:"text-slate-500 mt-4",children:"Checking invitation..."})]}),"unauthenticated"===x&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"p-4 rounded-xl bg-slate-50 dark:bg-slate-800 text-center",children:(0,a.jsx)("p",{className:"text-slate-600 dark:text-slate-400",children:"Please sign in to accept this invitation."})}),(0,a.jsxs)(p.$,{className:"w-full",onClick:()=>{t&&sessionStorage.setItem("pendingInviteToken",t),e.push("/signin")},children:[(0,a.jsx)(d,{className:"h-4 w-4 mr-2"}),"Sign In to Continue"]}),(0,a.jsxs)("p",{className:"text-center text-sm text-slate-500",children:["Don't have an account?"," ",(0,a.jsx)(i(),{href:"/signup",className:"text-orange-500 hover:underline",children:"Sign up"})]})]}),"ready"===x&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"p-4 rounded-xl bg-orange-50 dark:bg-orange-900/20 text-center",children:(0,a.jsx)("p",{className:"text-orange-700 dark:text-orange-400",children:"Click below to join the family group. You'll gain access to shared recipes, meal plans, and more."})}),(0,a.jsx)(p.$,{className:"w-full",onClick:w,disabled:l,children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Joining..."]}):"Accept Invitation"})]}),"success"===x&&y&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-4 rounded-xl bg-green-50 dark:bg-green-900/20 text-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-3",children:(0,a.jsx)(u.A,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),(0,a.jsxs)("p",{className:"font-medium text-green-700 dark:text-green-400",children:["Welcome to ",y.groupName,"!"]}),(0,a.jsxs)("p",{className:"text-sm text-green-600 dark:text-green-500 mt-1",children:["You've joined as a ",(0,a.jsx)("span",{className:"font-medium capitalize",children:y.role}),"."]})]}),(0,a.jsx)(p.$,{className:"w-full",asChild:!0,children:(0,a.jsx)(i(),{href:"/app/family",children:"Go to Family Dashboard"})})]}),"error"===x&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-4 rounded-xl bg-red-50 dark:bg-red-900/20 text-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-3",children:(0,a.jsx)(c.A,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),(0,a.jsx)("p",{className:"font-medium text-red-700 dark:text-red-400",children:"Unable to Join"}),(0,a.jsx)("p",{className:"text-sm text-red-600 dark:text-red-500 mt-1",children:j||"The invitation may have expired or is invalid."})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(p.$,{variant:"outline",className:"flex-1",asChild:!0,children:(0,a.jsx)(i(),{href:"/",children:"Go Home"})}),(0,a.jsx)(p.$,{className:"flex-1",onClick:()=>g("ready"),children:"Try Again"})]})]})]})]})})}function g(){return(0,a.jsx)(s.Suspense,{fallback:(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 flex items-center justify-center p-4",children:(0,a.jsx)(m.Zp,{className:"w-full max-w-md",children:(0,a.jsx)(m.Wu,{className:"py-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto"}),(0,a.jsx)("p",{className:"text-slate-500 mt-4",children:"Loading..."})]})})})}),children:(0,a.jsx)(x,{})})}}},e=>{e.O(0,[9731,9631,7139,3948,5885,6939,1170,7358],()=>e(e.s=43131)),_N_E=e.O()}]);