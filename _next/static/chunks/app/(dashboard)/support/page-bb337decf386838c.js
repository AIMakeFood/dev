(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[110],{50497:(e,t,s)=>{"use strict";var r=s(60685);s.o(r,"usePathname")&&s.d(t,{usePathname:function(){return r.usePathname}}),s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}}),s.o(r,"useSearchParams")&&s.d(t,{useSearchParams:function(){return r.useSearchParams}})},57158:(e,t,s)=>{Promise.resolve().then(s.bind(s,93571))},69339:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var r=s(21555),a=s(15885);function l(){let[e,t]=(0,r.useState)(null),[s,l]=(0,r.useState)(!0),[i,n]=(0,r.useState)(!1),[c,o]=(0,r.useState)(null),u=(0,r.useCallback)(async()=>{try{let e=(0,a.getSupabase)(),{data:s,error:r}=await e.auth.refreshSession();if(r)return console.error("[useAuth] Refresh error:",r),!1;if(!s?.session)return console.error("[useAuth] No session returned after refresh"),!1;return o(s.session),t(s.session.user),console.log("[useAuth] Session refreshed successfully"),!0}catch(e){return console.error("[useAuth] Failed to refresh:",e),!1}},[]);return(0,r.useEffect)(()=>{a.api.getUser().then(({data:{user:e}})=>{t(e),l(!1),n(!0)}).catch(()=>{l(!1),n(!0)});let{data:{subscription:e}}=a.api.onAuthStateChange(async(e,s)=>{console.log("[useAuth] Auth state change:",e),"TOKEN_REFRESHED"===e&&console.log("[useAuth] Token refreshed successfully"),o(s),t(s?.user??null),l(!1),n(!0)});return()=>e.unsubscribe()},[]),{user:e,session:c,loading:s,isReady:i,authenticated:!!e,refreshSession:u,signOut:()=>a.api.signOut()}}},84570:(e,t,s)=>{"use strict";s.d(t,{c0:()=>d,Gs:()=>c,oJ:()=>u,yS:()=>n,dS:()=>i,tY:()=>o});var r=s(21555),a=s(15885);function l(e={}){let{onTicketCreated:t,onTicketUpdated:s,onTicketDeleted:i,onMessageAdded:n,ticketId:c}=e;(0,r.useEffect)(()=>{let e=(0,a.getSupabase)(),r=e.channel("support_tickets_changes").on("postgres_changes",{event:"INSERT",schema:"api",table:"support_tickets"},e=>{console.log("Ticket created:",e),t?.(e)}).on("postgres_changes",{event:"UPDATE",schema:"api",table:"support_tickets",...c?{filter:`id=eq.${c}`}:{}},e=>{console.log("Ticket updated:",e),s?.(e)}).on("postgres_changes",{event:"DELETE",schema:"api",table:"support_tickets"},e=>{console.log("Ticket deleted:",e),i?.(e)}).subscribe(),l=null;return c&&n&&(l=e.channel("ticket_messages_changes").on("postgres_changes",{event:"INSERT",schema:"api",table:"ticket_messages",filter:`ticket_id=eq.${c}`},e=>{console.log("Message added:",e),n(e)}).subscribe()),()=>{e.removeChannel(r),l&&e.removeChannel(l)}},[t,s,i,n,c])}function i(e={}){let[t,s]=(0,r.useState)([]),[n,c]=(0,r.useState)(!0),[o,u]=(0,r.useState)(null),[d,h]=(0,r.useState)(0),g=(0,r.useCallback)(async()=>{try{c(!0),u(null);let{tickets:t,total:r}=await a.api.getTickets({status:e.status,category:e.category,assigned_to:e.assigned_to});s(t),h(r)}catch(e){u(e instanceof Error?e.message:"Failed to fetch tickets")}finally{c(!1)}},[e.status,e.category,e.assigned_to]);return(0,r.useEffect)(()=>{if(g(),e.autoRefresh&&e.refreshInterval){let t=setInterval(g,e.refreshInterval);return()=>clearInterval(t)}},[g,e.autoRefresh,e.refreshInterval]),l({onTicketCreated:!1!==e.enableRealtime?()=>g():void 0,onTicketUpdated:!1!==e.enableRealtime?()=>g():void 0,onTicketDeleted:!1!==e.enableRealtime?()=>g():void 0}),{tickets:t,loading:n,error:o,total:d,refetch:g}}function n(e,t=!0){let[s,i]=(0,r.useState)(null),[c,o]=(0,r.useState)(!0),[u,d]=(0,r.useState)(null),h=(0,r.useCallback)(async()=>{if(!e){i(null),o(!1);return}try{o(!0),d(null);let t=await a.api.getTicket(e);i(t)}catch(e){d(e instanceof Error?e.message:"Failed to fetch ticket")}finally{o(!1)}},[e]);return(0,r.useEffect)(()=>{h()},[h]),l({ticketId:e||void 0,onTicketUpdated:t?()=>h():void 0,onMessageAdded:t?()=>h():void 0}),{ticket:s,loading:c,error:u,refetch:h}}function c(){let[e,t]=(0,r.useState)(!1),[s,l]=(0,r.useState)(null);return{createTicket:async e=>{try{return t(!0),l(null),(await a.api.createTicket(e)).ticket}catch(t){let e=t instanceof Error?t.message:"Failed to create ticket";throw l(e),Error(e)}finally{t(!1)}},loading:e,error:s}}function o(){let[e,t]=(0,r.useState)(!1),[s,l]=(0,r.useState)(null);return{updateTicket:async e=>{try{return t(!0),l(null),(await a.api.updateTicket(e)).ticket}catch(t){let e=t instanceof Error?t.message:"Failed to update ticket";throw l(e),Error(e)}finally{t(!1)}},loading:e,error:s}}function u(){let[e,t]=(0,r.useState)(!1),[s,l]=(0,r.useState)(null);return{escalateTicket:async e=>{try{return t(!0),l(null),(await a.api.escalateTicket(e)).ticket}catch(t){let e=t instanceof Error?t.message:"Failed to escalate ticket";throw l(e),Error(e)}finally{t(!1)}},loading:e,error:s}}function d(){let[e,t]=(0,r.useState)(!1),[s,l]=(0,r.useState)(null);return{addMessage:async e=>{try{return t(!0),l(null),(await a.api.addTicketMessage(e)).message}catch(t){let e=t instanceof Error?t.message:"Failed to add message";throw l(e),Error(e)}finally{t(!1)}},loading:e,error:s}}},93571:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var r=s(55155),a=s(21555),l=s(69339),i=s(50497),n=s(84570);function c(){let{user:e,loading:t}=(0,l.A)(),s=(0,i.useRouter)(),{tickets:c,loading:o,refetch:u}=(0,n.dS)({autoRefresh:!0,refreshInterval:3e4}),{createTicket:d,loading:h}=(0,n.Gs)(),[g,p]=(0,a.useState)(!1),[m,x]=(0,a.useState)({title:"",description:"",category:"other",priority:"medium"});(0,a.useEffect)(()=>{t||e||s.push("/auth/login")},[e,t,s]);let f=async e=>{e.preventDefault();try{await d(m),x({title:"",description:"",category:"other",priority:"medium"}),p(!1),u()}catch(e){console.error("Failed to create ticket:",e)}};return t||o?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Support Center"}),(0,r.jsx)("p",{className:"mt-2 text-gray-600",children:"Get help with your account and the platform"})]}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)("button",{onClick:()=>p(!g),className:"px-6 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 font-medium",children:g?"Cancel":"+ New Support Ticket"})}),g&&(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Create New Ticket"}),(0,r.jsxs)("form",{onSubmit:f,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Subject *"}),(0,r.jsx)("input",{type:"text",value:m.title,onChange:e=>x({...m,title:e.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent",placeholder:"Brief description of your issue"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category *"}),(0,r.jsxs)("select",{value:m.category,onChange:e=>x({...m,category:e.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"subscription",children:"Subscription"}),(0,r.jsx)("option",{value:"technical",children:"Technical Issue"}),(0,r.jsx)("option",{value:"account",children:"Account"}),(0,r.jsx)("option",{value:"billing",children:"Billing"}),(0,r.jsx)("option",{value:"feature_request",children:"Feature Request"}),(0,r.jsx)("option",{value:"bug_report",children:"Bug Report"}),(0,r.jsx)("option",{value:"other",children:"Other"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority"}),(0,r.jsxs)("select",{value:m.priority,onChange:e=>x({...m,priority:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[(0,r.jsx)("option",{value:"low",children:"Low"}),(0,r.jsx)("option",{value:"medium",children:"Medium"}),(0,r.jsx)("option",{value:"high",children:"High"}),(0,r.jsx)("option",{value:"urgent",children:"Urgent"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),(0,r.jsx)("textarea",{value:m.description,onChange:e=>x({...m,description:e.target.value}),required:!0,rows:6,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent resize-none",placeholder:"Please provide as much detail as possible about your issue..."})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{type:"button",onClick:()=>p(!1),className:"px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:h,className:"px-6 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Creating...":"Submit Ticket"})]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,r.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Your Support Tickets"})}),(0,r.jsx)("div",{className:"divide-y divide-gray-200",children:0===c.length?(0,r.jsxs)("div",{className:"p-12 text-center",children:[(0,r.jsx)("p",{className:"text-gray-500",children:"No support tickets yet"}),(0,r.jsx)("p",{className:"text-gray-400 text-sm mt-2",children:"Create a ticket if you need help with anything"})]}):c.map(e=>{let t,a;return(0,r.jsx)("div",{className:"p-6 hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>s.push(`/support/ticket?id=${e.id}`),children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.title}),(0,r.jsx)("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${{low:"bg-gray-100 text-gray-800",medium:"bg-blue-100 text-blue-800",high:"bg-orange-100 text-orange-800",urgent:"bg-red-100 text-red-800"}[e.priority]||"bg-gray-100 text-gray-800"}`,children:e.priority})]}),(0,r.jsx)("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:e.description}),(0,r.jsxs)("div",{className:"flex gap-4 text-xs text-gray-500",children:[(0,r.jsxs)("span",{children:["Category: ",e.category.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")]}),(0,r.jsxs)("span",{children:["Created: ",(t=new Date(e.created_at),0===(a=Math.floor((new Date().getTime()-t.getTime())/864e5))?"Today":1===a?"Yesterday":a<7?`${a} days ago`:t.toLocaleDateString())]})]})]}),(0,r.jsx)("div",{className:"ml-4 flex-shrink-0",children:(0,r.jsx)("span",{className:`px-4 py-2 text-sm font-medium rounded-full ${{open:"bg-blue-100 text-blue-800",in_progress:"bg-yellow-100 text-yellow-800",waiting_response:"bg-purple-100 text-purple-800",escalated:"bg-red-100 text-red-800",resolved:"bg-green-100 text-green-800",closed:"bg-gray-100 text-gray-800"}[e.status]||"bg-gray-100 text-gray-800"}`,children:e.status.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")})})]})},e.id)})})]})]})})}}},e=>{e.O(0,[9731,9631,5885,6939,1170,7358],()=>e(e.s=57158)),_N_E=e.O()}]);