(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7248],{23866:(e,r,t)=>{Promise.resolve().then(t.bind(t,83563))},50497:(e,r,t)=>{"use strict";var a=t(60685);t.o(a,"usePathname")&&t.d(r,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})},69339:(e,r,t)=>{"use strict";t.d(r,{A:()=>d});var a=t(21555),s=t(15885);function d(){let[e,r]=(0,a.useState)(null),[t,d]=(0,a.useState)(!0),[l,n]=(0,a.useState)(!1),[o,i]=(0,a.useState)(null),c=(0,a.useCallback)(async()=>{try{let e=(0,s.getSupabase)(),{data:t,error:a}=await e.auth.refreshSession();if(a)return console.error("[useAuth] Refresh error:",a),!1;if(!t?.session)return console.error("[useAuth] No session returned after refresh"),!1;return i(t.session),r(t.session.user),console.log("[useAuth] Session refreshed successfully"),!0}catch(e){return console.error("[useAuth] Failed to refresh:",e),!1}},[]);return(0,a.useEffect)(()=>{s.api.getUser().then(({data:{user:e}})=>{r(e),d(!1),n(!0)}).catch(()=>{d(!1),n(!0)});let{data:{subscription:e}}=s.api.onAuthStateChange(async(e,t)=>{console.log("[useAuth] Auth state change:",e),"TOKEN_REFRESHED"===e&&console.log("[useAuth] Token refreshed successfully"),i(t),r(t?.user??null),d(!1),n(!0)});return()=>e.unsubscribe()},[]),{user:e,session:o,loading:t,isReady:l,authenticated:!!e,refreshSession:c,signOut:()=>s.api.signOut()}}},83563:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>c});var a=t(55155),s=t(21555),d=t(69339),l=t(50497),n=t(15885);let o=[{value:"referral_code",label:"Referral Codes"},{value:"display_name",label:"Display Names"},{value:"community_post",label:"Community Posts"},{value:"recipe",label:"Recipes"},{value:"ticket",label:"Support Tickets"},{value:"comment",label:"Comments"}],i={word:"",word_type:"bad",contexts:[],notes:""};function c(){let{user:e,loading:r}=(0,d.A)(),t=(0,l.useRouter)(),[c,x]=(0,s.useState)(null),[u,m]=(0,s.useState)([]),[g,h]=(0,s.useState)(!0),[y,p]=(0,s.useState)(null),[b,f]=(0,s.useState)(null),[k,j]=(0,s.useState)(1),[w,v]=(0,s.useState)(1),[N,S]=(0,s.useState)(0),[_,C]=(0,s.useState)(""),[A,W]=(0,s.useState)("all"),[E,F]=(0,s.useState)(!1),[R,P]=(0,s.useState)(null),[T,O]=(0,s.useState)(i),[D,M]=(0,s.useState)(null),[B,L]=(0,s.useState)(!1),[U,q]=(0,s.useState)(null),z=(0,s.useCallback)(async()=>{h(!0),p(null);try{let e=await n.api.getFilteredWords({page:k,limit:20,word_type:"all"===A?void 0:A,search:_||void 0});m(e.words),v(e.total_pages),S(e.total)}catch(e){p(e instanceof Error?e.message:"Failed to fetch filtered words")}finally{h(!1)}},[k,20,A,_]);(0,s.useEffect)(()=>{r||e?e&&n.api.getProfile().then(e=>{x(e),e&&"admin"!==e.user_role&&t.push("/dashboard")}).catch(()=>{t.push("/dashboard")}):t.push("/auth/login")},[e,r,t]),(0,s.useEffect)(()=>{c?.user_role==="admin"&&z()},[c,z]),(0,s.useEffect)(()=>{j(1)},[_,A]);let H=e=>{e?(P(e),O({word:e.word,word_type:e.word_type,contexts:e.contexts||[],notes:e.notes||""})):(P(null),O(i)),M(null),F(!0)},K=()=>{F(!1),P(null),O(i),M(null)},$=async e=>{e.preventDefault(),M(null),L(!0);try{R?(await n.api.updateFilteredWord({id:R.id,word:T.word,word_type:T.word_type,contexts:T.contexts,notes:T.notes||null}),f("Word updated successfully")):(await n.api.createFilteredWord({word:T.word,word_type:T.word_type,contexts:T.contexts,notes:T.notes||void 0}),f("Word added successfully")),K(),z(),setTimeout(()=>f(null),3e3)}catch(e){M(e.message||"Failed to save")}finally{L(!1)}},G=async e=>{try{await n.api.deleteFilteredWord(e),q(null),f("Word deleted successfully"),z(),setTimeout(()=>f(null),3e3)}catch(e){p(e instanceof Error?e.message:"Failed to delete")}};return r?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):c&&"admin"===c.user_role?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8",children:[(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"mb-8 flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Filtered Words"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"Manage words that are blocked across the platform"})]}),(0,a.jsx)("button",{onClick:()=>H(),className:"px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors font-medium",children:"Add Word"})]}),b&&(0,a.jsx)("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4 dark:bg-green-900/20 dark:border-green-800",children:(0,a.jsx)("p",{className:"text-green-800 dark:text-green-200",children:b})}),y&&(0,a.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4 dark:bg-red-900/20 dark:border-red-800",children:(0,a.jsx)("p",{className:"text-red-800 dark:text-red-200",children:y})}),(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Search"}),(0,a.jsx)("input",{type:"text",value:_,onChange:e=>C(e.target.value),placeholder:"Search words...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Type"}),(0,a.jsxs)("select",{value:A,onChange:e=>W(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,a.jsx)("option",{value:"all",children:"All Types"}),(0,a.jsx)("option",{value:"bad",children:"Bad Words"}),(0,a.jsx)("option",{value:"reserved",children:"Reserved Words"})]})]})]})}),(0,a.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden",children:g?(0,a.jsxs)("div",{className:"p-12 text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-500 dark:text-gray-400",children:"Loading..."})]}):0===u.length?(0,a.jsxs)("div",{className:"p-12 text-center",children:[(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-lg",children:"No filtered words found"}),(0,a.jsx)("p",{className:"text-gray-400 dark:text-gray-500 text-sm mt-2",children:_||"all"!==A?"Try adjusting your filters":'Click "Add Word" to get started'})]}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Word"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Type"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Contexts"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Notes"}),(0,a.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:u.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"font-medium text-gray-900 dark:text-white",children:e.word})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${"bad"===e.word_type?"bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300"}`,children:e.word_type})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:"bad"===e.word_type?(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:"All contexts"}):e.contexts&&e.contexts.length>0?e.contexts.map(e=>(0,a.jsx)("span",{className:"px-2 py-0.5 text-xs bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded",children:e.replace(/_/g," ")},e)):(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:"All contexts"})})}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400 truncate max-w-xs block",children:e.notes||"-"})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:[(0,a.jsx)("button",{onClick:()=>H(e),className:"text-emerald-600 hover:text-emerald-800 dark:text-emerald-400 dark:hover:text-emerald-300 mr-4",children:"Edit"}),U===e.id?(0,a.jsxs)("span",{className:"inline-flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>G(e.id),className:"text-red-600 hover:text-red-800 dark:text-red-400 font-medium",children:"Confirm"}),(0,a.jsx)("button",{onClick:()=>q(null),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400",children:"Cancel"})]}):(0,a.jsx)("button",{onClick:()=>q(e.id),className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:"Delete"})]})]},e.id))})]})})}),w>1&&(0,a.jsxs)("div",{className:"mt-6 flex items-center justify-between",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Showing ",(k-1)*20+1," to ",Math.min(20*k,N)," of ",N," words"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>j(e=>Math.max(1,e-1)),disabled:1===k,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",children:"Previous"}),(0,a.jsx)("button",{onClick:()=>j(e=>Math.min(w,e+1)),disabled:k===w,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300",children:"Next"})]})]})]}),E&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,a.jsxs)("div",{className:"flex min-h-full items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 transition-opacity",onClick:K}),(0,a.jsxs)("div",{className:"relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-lg w-full p-6",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-6",children:R?"Edit Filtered Word":"Add Filtered Word"}),(0,a.jsxs)("form",{onSubmit:$,className:"space-y-4",children:[D&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 dark:bg-red-900/20 dark:border-red-800",children:(0,a.jsx)("p",{className:"text-red-800 dark:text-red-200 text-sm",children:D})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Word *"}),(0,a.jsx)("input",{type:"text",value:T.word,onChange:e=>O(r=>({...r,word:e.target.value})),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Enter word or phrase"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Type *"}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"word_type",value:"bad",checked:"bad"===T.word_type,onChange:()=>O(e=>({...e,word_type:"bad"})),className:"mr-2 text-emerald-600 focus:ring-emerald-500"}),(0,a.jsxs)("span",{className:"text-gray-700 dark:text-gray-300",children:["Bad Word",(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-1",children:"(blocked everywhere)"})]})]}),(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"radio",name:"word_type",value:"reserved",checked:"reserved"===T.word_type,onChange:()=>O(e=>({...e,word_type:"reserved"})),className:"mr-2 text-emerald-600 focus:ring-emerald-500"}),(0,a.jsxs)("span",{className:"text-gray-700 dark:text-gray-300",children:["Reserved Word",(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-1",children:"(context-specific)"})]})]})]})]}),"reserved"===T.word_type&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["Contexts",(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 ml-1",children:"(leave empty to block in all contexts)"})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:o.map(e=>(0,a.jsxs)("label",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:T.contexts.includes(e.value),onChange:()=>{var r;return r=e.value,void O(e=>({...e,contexts:e.contexts.includes(r)?e.contexts.filter(e=>e!==r):[...e.contexts,r]}))},className:"mr-2 rounded text-emerald-600 focus:ring-emerald-500"}),(0,a.jsx)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.label})]},e.value))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Notes"}),(0,a.jsx)("textarea",{value:T.notes,onChange:e=>O(r=>({...r,notes:e.target.value})),rows:2,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white",placeholder:"Optional notes about why this word is filtered"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:K,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:B,className:"px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed",children:B?"Saving...":R?"Update":"Add"})]})]})]})]})})]}):null}}},e=>{e.O(0,[9731,9631,5885,6939,1170,7358],()=>e(e.s=23866)),_N_E=e.O()}]);