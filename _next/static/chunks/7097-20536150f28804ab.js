"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7097],{10003:(e,s,a)=>{a.d(s,{J:()=>d});var t=a(55155),r=a(21555),l=a(52719),i=a(47426),n=a(31616);let o=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)(l.b,{ref:a,className:(0,n.cn)(o(),e),...s}));d.displayName=l.b.displayName},11428:(e,s,a)=>{a.d(s,{H:()=>l,h:()=>i});var t=a(21555),r=a(15885);function l(){let[e,s]=(0,t.useState)(null),[a,l]=(0,t.useState)(!0),[i,n]=(0,t.useState)(null),[o,d]=(0,t.useState)(!1),c=(0,t.useCallback)(async()=>{try{l(!0),n(null);let e=await r.api.getFamilyGroup();s(e)}catch(e){console.error("[useFamilyGroup] Failed to fetch group:",e),n(e instanceof Error?e:Error("Failed to fetch family group"))}finally{l(!1)}},[]);(0,t.useEffect)(()=>{c()},[c]);let m=(0,t.useMemo)(()=>{if(!e?.memberGroup)return null;let s=e.memberGroup;return{id:s.id,name:s.name,inviteCode:s.invite_code,status:s.status,createdAt:s.created_at,members:s.members.map(e=>({id:e.id,userId:e.user_id,role:e.role,joinedAt:e.joined_at,displayName:e.user.display_name,avatarUrl:e.user.avatar_url})),permissions:s.permissions,pendingInvitations:s.pendingInvitations.map(e=>({id:e.id,email:e.email,role:e.role,expiresAt:e.expires_at,inviteToken:e.invite_token}))}},[e]),x=(0,t.useMemo)(()=>e?.visitorGroups?e.visitorGroups.map(e=>({id:e.id,name:e.name,role:"visitor",joinedAt:e.joined_at})):[],[e]),u=e?.userRole||null,p=!!m,h=(0,t.useCallback)(async e=>{try{return d(!0),await r.api.createFamilyGroup(e),await c(),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to create group"}}finally{d(!1)}},[c]),f=(0,t.useCallback)(async e=>{if(!m)return{success:!1,error:"No group found"};try{return d(!0),await r.api.updateFamilyGroup(m.id,e),await c(),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to update group"}}finally{d(!1)}},[m,c]),b=(0,t.useCallback)(async()=>{if(!m)return{success:!1,error:"No group found"};try{return d(!0),await r.api.deleteFamilyGroup(m.id,!0),await c(),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to delete group"}}finally{d(!1)}},[m,c]),g=(0,t.useCallback)(async(e,s)=>{if(!m)return{success:!1,error:"No group found"};try{d(!0);let a=await r.api.inviteFamilyMember(m.id,e,s);return await c(),{success:!0,inviteLink:a.inviteLink}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to invite member"}}finally{d(!1)}},[m,c]),j=(0,t.useCallback)(async e=>{if(!m)return{success:!1,error:"No group found"};try{return d(!0),await r.api.removeFamilyMember(m.id,e),await c(),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to remove member"}}finally{d(!1)}},[m,c]),N=(0,t.useCallback)(async(e,s)=>{if(!m)return{success:!1,error:"No group found"};try{return d(!0),await r.api.updateMemberRole(m.id,e,s),await c(),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to update role"}}finally{d(!1)}},[m,c]),v=(0,t.useCallback)(async e=>{let s=e||m?.id;if(!s)return{success:!1,error:"No group found"};try{return d(!0),await r.api.leaveFamilyGroup(s,!0),await c(),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to leave group"}}finally{d(!1)}},[m,c]),y=(0,t.useCallback)(()=>m?.members.filter(e=>"owner"===e.role)||[],[m]),w=(0,t.useCallback)(()=>m?.members.filter(e=>"member"===e.role)||[],[m]),k=(0,t.useCallback)(()=>m?.members.filter(e=>"visitor"===e.role)||[],[m]),C=m?.status==="grace_period",A=m?.status==="frozen",R=m?.status==="active";return{group:m,visitorGroups:x,userRole:u,isOwner:"owner"===u,isMember:"member"===u,isVisitor:"visitor"===u,hasGroup:p,isActive:R,isGracePeriod:C,isFrozen:A,loading:a,actionLoading:o,error:i,refresh:c,createGroup:h,updateGroup:f,deleteGroup:b,inviteMember:g,removeMember:j,updateRole:N,leaveGroup:v,getOwners:y,getMembers:w,getVisitors:k,ownerCount:y().length,memberCount:w().length,visitorCount:k().length,totalMembers:m?.members.length||0,pendingInvitationsCount:m?.pendingInvitations.length||0}}function i(){let[e,s]=(0,t.useState)(!1),[a,l]=(0,t.useState)(null);return{acceptInvite:(0,t.useCallback)(async e=>{try{s(!0),l(null);let a=await r.api.acceptFamilyInvite(e);return{success:!0,groupName:a.group.name,role:a.role}}catch(s){let e=s instanceof Error?s.message:"Failed to accept invitation";return l(s instanceof Error?s:Error(e)),{success:!1,error:e}}finally{s(!1)}},[]),loading:e,error:a}}},23381:(e,s,a)=>{a.d(s,{p:()=>l});var t=a(55155),r=a(31616);function l({className:e,type:s,...a}){return(0,t.jsx)("input",{type:s,"data-slot":"input",className:(0,r.cn)("flex h-11 w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-2 text-base text-slate-900 dark:text-white shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-slate-900 dark:file:text-white placeholder:text-slate-400 dark:placeholder:text-gray-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-orange-500 focus-visible:border-orange-500 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...a})}},31616:(e,s,a)=>{a.d(s,{cn:()=>l});var t=a(43696),r=a(33086);function l(...e){return(0,r.QP)((0,t.$)(e))}},33971:(e,s,a)=>{a.d(s,{$:()=>o,r:()=>n});var t=a(55155),r=a(3456),l=a(47426),i=a(31616);let n=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-bold transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:ring-2 focus-visible:ring-orange-500 focus-visible:ring-offset-2",{variants:{variant:{default:"bg-orange-500 text-white hover:bg-orange-600 shadow-md shadow-orange-200 dark:shadow-orange-900/20",destructive:"bg-red-500 text-white hover:bg-red-600 shadow-md shadow-red-200 dark:shadow-red-900/20",outline:"border-2 border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-slate-900 dark:text-white hover:bg-slate-50 dark:hover:bg-slate-800 hover:border-slate-300 dark:hover:border-slate-600",secondary:"bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-white hover:bg-slate-200 dark:hover:bg-slate-700",ghost:"hover:bg-slate-100 dark:hover:bg-slate-800 text-slate-900 dark:text-white",link:"text-orange-500 dark:text-orange-400 underline-offset-4 hover:underline"},size:{default:"h-11 px-5 py-2",sm:"h-9 rounded-lg px-3 text-xs",lg:"h-14 rounded-2xl px-8 text-base",icon:"size-10"}},defaultVariants:{variant:"default",size:"default"}});function o({className:e,variant:s,size:a,asChild:l=!1,...o}){let d=l?r.DX:"button";return(0,t.jsx)(d,{"data-slot":"button",className:(0,i.cn)(n({variant:s,size:a,className:e})),...o})}},57809:(e,s,a)=>{a.d(s,{BT:()=>o,Wu:()=>d,ZB:()=>n,Zp:()=>l,aR:()=>i});var t=a(55155),r=a(31616);function l({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-white dark:bg-slate-900 text-slate-900 dark:text-white flex flex-col gap-6 rounded-2xl border border-slate-200 dark:border-slate-800 py-6 shadow-sm",e),...s})}function i({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("flex flex-col gap-1.5 px-6",e),...s})}function n({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-bold tracking-tight text-xl",e),...s})}function o({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-slate-600 dark:text-slate-400 text-sm",e),...s})}function d({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",e),...s})}},87097:(e,s,a)=>{a.d(s,{TM:()=>O,dx:()=>eo,U8:()=>ei,tf:()=>B,BO:()=>ev});var t=a(55155),r=a(21555),l=a(67649),i=a(18546),n=a(3738),o=a(13851),d=a(9667),c=a(80461),m=a(6949),x=a(57809),u=a(33971),p=a(11428),h=a(78503),f=a(67130),b=a(85986),g=a(20956),j=a(70705),N=a(29688),v=a(5762),y=a(78562),w=a(28198),k=a(31616);let C=N.bL,A=N.l9;N.YJ,N.ZL,N.Pb,N.z6,r.forwardRef(({className:e,inset:s,children:a,...r},l)=>(0,t.jsxs)(N.ZP,{ref:l,className:(0,k.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-slate-100 data-[state=open]:bg-slate-100 dark:focus:bg-slate-800 dark:data-[state=open]:bg-slate-800",s&&"pl-8",e),...r,children:[a,(0,t.jsx)(v.A,{className:"ml-auto h-4 w-4"})]})).displayName=N.ZP.displayName,r.forwardRef(({className:e,...s},a)=>(0,t.jsx)(N.G5,{ref:a,className:(0,k.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-white p-1 text-slate-950 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50",e),...s})).displayName=N.G5.displayName;let R=r.forwardRef(({className:e,sideOffset:s=4,...a},r)=>(0,t.jsx)(N.ZL,{children:(0,t.jsx)(N.UC,{ref:r,sideOffset:s,className:(0,k.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-white p-1 text-slate-950 shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 dark:border-slate-800 dark:bg-slate-950 dark:text-slate-50",e),...a})}));R.displayName=N.UC.displayName;let F=r.forwardRef(({className:e,inset:s,...a},r)=>(0,t.jsx)(N.q7,{ref:r,className:(0,k.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-slate-100 focus:text-slate-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-slate-800 dark:focus:text-slate-50",s&&"pl-8",e),...a}));F.displayName=N.q7.displayName,r.forwardRef(({className:e,children:s,checked:a,...r},l)=>(0,t.jsxs)(N.H_,{ref:l,className:(0,k.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-slate-100 focus:text-slate-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-slate-800 dark:focus:text-slate-50",e),checked:a,...r,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(N.VF,{children:(0,t.jsx)(y.A,{className:"h-4 w-4"})})}),s]})).displayName=N.H_.displayName,r.forwardRef(({className:e,children:s,...a},r)=>(0,t.jsxs)(N.hN,{ref:r,className:(0,k.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-slate-100 focus:text-slate-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50 dark:focus:bg-slate-800 dark:focus:text-slate-50",e),...a,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(N.VF,{children:(0,t.jsx)(w.A,{className:"h-2 w-2 fill-current"})})}),s]})).displayName=N.hN.displayName,r.forwardRef(({className:e,inset:s,...a},r)=>(0,t.jsx)(N.JU,{ref:r,className:(0,k.cn)("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",e),...a})).displayName=N.JU.displayName;let z=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)(N.wv,{ref:a,className:(0,k.cn)("-mx-1 my-1 h-px bg-slate-100 dark:bg-slate-800",e),...s}));z.displayName=N.wv.displayName;var G=a(1396);let S=G.bL;G.l9;let $=G.ZL,_=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)(G.hJ,{className:(0,k.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s,ref:a}));_.displayName=G.hJ.displayName;let E=r.forwardRef(({className:e,...s},a)=>(0,t.jsxs)($,{children:[(0,t.jsx)(_,{}),(0,t.jsx)(G.UC,{ref:a,className:(0,k.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-white dark:bg-slate-900 p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s})]}));E.displayName=G.UC.displayName;let P=({className:e,...s})=>(0,t.jsx)("div",{className:(0,k.cn)("flex flex-col space-y-2 text-center sm:text-left",e),...s});P.displayName="AlertDialogHeader";let Z=({className:e,...s})=>(0,t.jsx)("div",{className:(0,k.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});Z.displayName="AlertDialogFooter";let M=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)(G.hE,{ref:a,className:(0,k.cn)("text-lg font-semibold",e),...s}));M.displayName=G.hE.displayName;let L=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)(G.VY,{ref:a,className:(0,k.cn)("text-sm text-slate-500 dark:text-slate-400",e),...s}));L.displayName=G.VY.displayName;let V=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)(G.rc,{ref:a,className:(0,k.cn)((0,u.r)(),e),...s}));V.displayName=G.rc.displayName;let D=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)(G.ZD,{ref:a,className:(0,k.cn)((0,u.r)({variant:"outline"}),"mt-2 sm:mt-0",e),...s}));function O({open:e,onOpenChange:s,title:a,description:r,confirmLabel:l="Confirm",cancelLabel:i="Cancel",destructive:n=!1,loading:o=!1,onConfirm:d}){let c=async()=>{await d()};return(0,t.jsx)(S,{open:e,onOpenChange:s,children:(0,t.jsxs)(E,{children:[(0,t.jsxs)(P,{children:[(0,t.jsx)(M,{children:a}),(0,t.jsx)(L,{children:r})]}),(0,t.jsxs)(Z,{children:[(0,t.jsx)(D,{disabled:o,children:i}),(0,t.jsx)(V,{asChild:!0,children:(0,t.jsx)(u.$,{variant:n?"destructive":"default",onClick:c,disabled:o,children:o?"Please wait...":l})})]})]})})}D.displayName=G.ZD.displayName;let I={owner:c.A,member:m.A,visitor:o.A},T={owner:"text-amber-500 bg-amber-50 dark:bg-amber-900/20",member:"text-blue-500 bg-blue-50 dark:bg-blue-900/20",visitor:"text-slate-500 bg-slate-100 dark:bg-slate-800"};function B({showActions:e=!0}){let{group:s,isOwner:a,ownerCount:l,removeMember:i,updateRole:n,leaveGroup:d,actionLoading:N}=(0,p.H)(),[v,y]=(0,r.useState)(null);if(!s)return null;let w=async e=>{let s=await i(e.userId);return s.success&&y(null),s},k=async(e,s)=>{let a=await n(e.userId,s);return a.success&&y(null),a},G=async()=>{let e=await d();return e.success&&y(null),e},S=s.members.filter(e=>"owner"===e.role),$=s.members.filter(e=>"member"===e.role),_=s.members.filter(e=>"visitor"===e.role),E=s=>{let r,i=I[s.role],n=T[s.role],o=!!a&&("owner"!==s.role||!(l<=1)),d=!!a&&("owner"!==s.role||!(l<=1)),c=(r=[],"visitor"===s.role?(r.push({role:"member",label:"Promote to Member",icon:h.A}),r.push({role:"owner",label:"Promote to Owner",icon:h.A})):"member"===s.role?(r.push({role:"owner",label:"Promote to Owner",icon:h.A}),r.push({role:"visitor",label:"Demote to Visitor",icon:f.A})):"owner"===s.role&&l>1&&(r.push({role:"member",label:"Demote to Member",icon:f.A}),r.push({role:"visitor",label:"Demote to Visitor",icon:f.A})),r);return(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[s.avatarUrl?(0,t.jsx)("img",{src:s.avatarUrl,alt:s.displayName,className:"w-10 h-10 rounded-full object-cover"}):(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center",children:(0,t.jsx)(m.A,{className:"h-5 w-5 text-slate-500"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:s.displayName}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs ${n}`,children:[(0,t.jsx)(i,{className:"h-3 w-3"}),s.role.charAt(0).toUpperCase()+s.role.slice(1)]}),(0,t.jsxs)("span",{className:"text-xs text-slate-400",children:["Joined ",new Date(s.joinedAt).toLocaleDateString()]})]})]})]}),e&&a&&(o||d)&&(0,t.jsxs)(C,{children:[(0,t.jsx)(A,{asChild:!0,children:(0,t.jsx)(u.$,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,t.jsx)(b.A,{className:"h-4 w-4"})})}),(0,t.jsxs)(R,{align:"end",children:[c.map(e=>(0,t.jsxs)(F,{onClick:()=>y({type:e.role===s.role||e.label.includes("Promote")?"promote":"demote",member:s,newRole:e.role}),children:[(0,t.jsx)(e.icon,{className:"h-4 w-4 mr-2"}),e.label]},e.role)),c.length>0&&d&&(0,t.jsx)(z,{}),d&&(0,t.jsxs)(F,{className:"text-red-600 focus:text-red-600",onClick:()=>y({type:"remove",member:s}),children:[(0,t.jsx)(g.A,{className:"h-4 w-4 mr-2"}),"Remove from Group"]})]})]})]},s.id)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(x.Zp,{children:[(0,t.jsxs)(x.aR,{children:[(0,t.jsx)(x.ZB,{children:"Members"}),(0,t.jsxs)(x.BT,{children:[s.members.length," member",1!==s.members.length?"s":""," in this group"]})]}),(0,t.jsxs)(x.Wu,{className:"space-y-6",children:[S.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"text-sm font-medium text-slate-500 mb-2 flex items-center gap-2",children:[(0,t.jsx)(c.A,{className:"h-4 w-4 text-amber-500"}),"Owners (",S.length,"/2)"]}),(0,t.jsx)("div",{className:"space-y-1",children:S.map(E)})]}),$.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"text-sm font-medium text-slate-500 mb-2 flex items-center gap-2",children:[(0,t.jsx)(m.A,{className:"h-4 w-4 text-blue-500"}),"Members (",$.length,")"]}),(0,t.jsx)("div",{className:"space-y-1",children:$.map(E)})]}),_.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"text-sm font-medium text-slate-500 mb-2 flex items-center gap-2",children:[(0,t.jsx)(o.A,{className:"h-4 w-4 text-slate-500"}),"Visitors (",_.length,")"]}),(0,t.jsx)("div",{className:"space-y-1",children:_.map(E)})]}),e&&(!a||l>1)&&(0,t.jsx)("div",{className:"pt-4 border-t border-slate-200 dark:border-slate-800",children:(0,t.jsxs)(u.$,{variant:"outline",className:"text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20",onClick:()=>y({type:"leave"}),children:[(0,t.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Leave Group"]})})]})]}),(0,t.jsx)(O,{open:v?.type==="remove",onOpenChange:e=>!e&&y(null),title:"Remove Member",description:`Are you sure you want to remove ${v?.member?.displayName} from the group? They will lose access to all shared content.`,confirmLabel:"Remove",destructive:!0,loading:N,onConfirm:()=>v?.member&&w(v.member)}),(0,t.jsx)(O,{open:v?.type==="promote",onOpenChange:e=>!e&&y(null),title:"Change Role",description:`Promote ${v?.member?.displayName} to ${v?.newRole}? Note: Role changes are limited to once per month.`,confirmLabel:"Confirm",loading:N,onConfirm:()=>v?.member&&v?.newRole&&k(v.member,v.newRole)}),(0,t.jsx)(O,{open:v?.type==="demote",onOpenChange:e=>!e&&y(null),title:"Change Role",description:`Demote ${v?.member?.displayName} to ${v?.newRole}? ${v?.newRole==="visitor"?"They will lose membership benefits.":""} Note: Role changes are limited to once per month.`,confirmLabel:"Confirm",loading:N,onConfirm:()=>v?.member&&v?.newRole&&k(v.member,v.newRole)}),(0,t.jsx)(O,{open:v?.type==="leave",onOpenChange:e=>!e&&y(null),title:"Leave Group",description:"Are you sure you want to leave this family group? You will lose access to all shared content.",confirmLabel:"Leave Group",destructive:!0,loading:N,onConfirm:G})]})}var J=a(77187),U=a(45681),W=a(68449),H=a(71212),Y=a(44746);let q=H.bL;H.l9;let Q=H.ZL;H.bm;let K=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)(H.hJ,{ref:a,className:(0,k.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s}));K.displayName=H.hJ.displayName;let X=r.forwardRef(({className:e,children:s,...a},r)=>(0,t.jsxs)(Q,{children:[(0,t.jsx)(K,{}),(0,t.jsxs)(H.UC,{ref:r,className:(0,k.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-white dark:bg-slate-900 p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...a,children:[s,(0,t.jsxs)(H.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-white transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-slate-950 focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-slate-100 data-[state=open]:text-slate-500 dark:ring-offset-slate-950 dark:focus:ring-slate-300 dark:data-[state=open]:bg-slate-800 dark:data-[state=open]:text-slate-400",children:[(0,t.jsx)(Y.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));X.displayName=H.UC.displayName;let ee=({className:e,...s})=>(0,t.jsx)("div",{className:(0,k.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...s});ee.displayName="DialogHeader";let es=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)(H.hE,{ref:a,className:(0,k.cn)("text-lg font-semibold leading-none tracking-tight",e),...s}));es.displayName=H.hE.displayName;let ea=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)(H.VY,{ref:a,className:(0,k.cn)("text-sm text-slate-500 dark:text-slate-400",e),...s}));ea.displayName=H.VY.displayName;var et=a(23381),er=a(10003);let el=[{role:"visitor",label:"Visitor",description:"Can view shared content but no membership benefits",icon:o.A},{role:"member",label:"Member",description:"Gets Basic-tier usage limits, full content access",icon:m.A},{role:"owner",label:"Owner",description:"Full control, can manage group and members",icon:c.A}];function ei({open:e,onOpenChange:s}){let{inviteMember:a,ownerCount:l,actionLoading:i}=(0,p.H)(),[n,o]=(0,r.useState)("visitor"),[d,c]=(0,r.useState)(""),[m,x]=(0,r.useState)(null),[h,f]=(0,r.useState)(!1),[b,g]=(0,r.useState)(null),j=async()=>{g(null);let e=await a(n,d||void 0);e.success&&e.inviteLink?x(e.inviteLink):e.error&&g(e.error)},N=async()=>{m&&(await navigator.clipboard.writeText(m),f(!0),setTimeout(()=>f(!1),2e3))},v=()=>{o("visitor"),c(""),x(null),f(!1),g(null),s(!1)},w=l<2;return(0,t.jsx)(q,{open:e,onOpenChange:v,children:(0,t.jsxs)(X,{className:"sm:max-w-md",children:[(0,t.jsxs)(ee,{children:[(0,t.jsx)(es,{children:"Invite to Family Group"}),(0,t.jsx)(ea,{children:m?"Share this link with your family member to invite them.":"Choose a role and optionally specify an email address."})]}),m?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(et.p,{value:m,readOnly:!0,className:"font-mono text-sm"}),(0,t.jsx)(u.$,{variant:"outline",size:"icon",onClick:N,children:h?(0,t.jsx)(y.A,{className:"h-4 w-4 text-green-500"}):(0,t.jsx)(J.A,{className:"h-4 w-4"})})]}),(0,t.jsxs)("p",{className:"text-sm text-slate-500",children:["This link expires in 7 days. The invited person will join as a"," ",(0,t.jsx)("span",{className:"font-medium capitalize",children:n}),"."]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(u.$,{variant:"outline",className:"flex-1",onClick:()=>x(null),children:"Create Another"}),(0,t.jsx)(u.$,{className:"flex-1",onClick:v,children:"Done"})]})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(er.J,{children:"Select Role"}),(0,t.jsx)("div",{className:"space-y-2",children:el.map(e=>{let s="owner"===e.role&&!w,a=e.icon;return(0,t.jsxs)("button",{type:"button",disabled:s,onClick:()=>o(e.role),className:`w-full flex items-start gap-3 p-3 rounded-xl border-2 transition-colors text-left ${n===e.role?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":"border-slate-200 dark:border-slate-700 hover:border-slate-300 dark:hover:border-slate-600"} ${s?"opacity-50 cursor-not-allowed":""}`,children:[(0,t.jsx)(a,{className:`h-5 w-5 mt-0.5 ${n===e.role?"text-orange-500":"text-slate-400"}`}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium",children:e.label}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:e.description}),s&&(0,t.jsx)("p",{className:"text-xs text-amber-600 mt-1",children:"Maximum 2 owners already reached"})]})]},e.role)})})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(er.J,{htmlFor:"email",children:"Email Address (Optional)"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(U.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400"}),(0,t.jsx)(et.p,{id:"email",type:"email",placeholder:"family@example.com",value:d,onChange:e=>c(e.target.value),className:"pl-10"})]}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"If provided, only this email can accept the invitation."})]}),"member"===n&&(0,t.jsx)("div",{className:"p-3 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-sm",children:(0,t.jsxs)("p",{className:"text-blue-700 dark:text-blue-400",children:[(0,t.jsx)("strong",{children:"Note:"})," Users can only be a member of one group at a time. If they are already a member elsewhere, they'll need to leave that group first."]})}),"owner"===n&&(0,t.jsx)("div",{className:"p-3 rounded-lg bg-amber-50 dark:bg-amber-900/20 text-sm",children:(0,t.jsxs)("p",{className:"text-amber-700 dark:text-amber-400",children:[(0,t.jsx)("strong",{children:"Note:"})," Owners have full control over the group including managing members and permissions. At least one owner must have a Pro subscription."]})}),b&&(0,t.jsx)("div",{className:"p-3 rounded-lg bg-red-50 dark:bg-red-900/20 text-sm text-red-600 dark:text-red-400",children:b}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(u.$,{variant:"outline",className:"flex-1",onClick:v,children:"Cancel"}),(0,t.jsxs)(u.$,{className:"flex-1",onClick:j,disabled:i,children:[(0,t.jsx)(W.A,{className:"h-4 w-4 mr-2"}),i?"Creating...":"Create Invite Link"]})]})]})]})})}function en({open:e,onOpenChange:s}){let{createGroup:a,actionLoading:l}=(0,p.H)(),[n,o]=(0,r.useState)(""),[d,c]=(0,r.useState)(null),m=async()=>{if(!n.trim())return void c("Please enter a group name");c(null);let e=await a(n.trim());e.success?(o(""),s(!1)):e.error&&c(e.error)},x=()=>{o(""),c(null),s(!1)};return(0,t.jsx)(q,{open:e,onOpenChange:x,children:(0,t.jsxs)(X,{className:"sm:max-w-md",children:[(0,t.jsxs)(ee,{children:[(0,t.jsxs)(es,{className:"flex items-center gap-2",children:[(0,t.jsx)(i.A,{className:"h-5 w-5"}),"Create Family Group"]}),(0,t.jsx)(ea,{children:"Create a family group to share recipes, meal plans, and more with your family members. Pro subscription required."})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(er.J,{htmlFor:"group-name",children:"Group Name"}),(0,t.jsx)(et.p,{id:"group-name",placeholder:"The Smith Family",value:n,onChange:e=>o(e.target.value),onKeyDown:e=>"Enter"===e.key&&m()})]}),(0,t.jsxs)("div",{className:"p-3 rounded-lg bg-orange-50 dark:bg-orange-900/20 text-sm",children:[(0,t.jsx)("p",{className:"text-orange-700 dark:text-orange-400",children:(0,t.jsx)("strong",{children:"What you'll get:"})}),(0,t.jsxs)("ul",{className:"list-disc list-inside mt-1 text-orange-600 dark:text-orange-300 space-y-0.5",children:[(0,t.jsx)("li",{children:"Invite up to 2 owners and unlimited members/visitors"}),(0,t.jsx)("li",{children:"Share recipes, shopping lists, and meal plans"}),(0,t.jsx)("li",{children:"Members get Basic-tier usage limits"}),(0,t.jsx)("li",{children:"Control what each role can access"})]})]}),d&&(0,t.jsx)("div",{className:"p-3 rounded-lg bg-red-50 dark:bg-red-900/20 text-sm text-red-600 dark:text-red-400",children:d}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(u.$,{variant:"outline",className:"flex-1",onClick:x,children:"Cancel"}),(0,t.jsx)(u.$,{className:"flex-1",onClick:m,disabled:l||!n.trim(),children:l?"Creating...":"Create Group"})]})]})]})})}function eo(){let{group:e,visitorGroups:s,userRole:a,isOwner:h,isMember:f,isGracePeriod:b,isFrozen:g,loading:j,error:N,ownerCount:v,memberCount:y,visitorCount:w,pendingInvitationsCount:k}=(0,p.H)(),[C,A]=(0,r.useState)(!1),[R,F]=(0,r.useState)(!1);return j?(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsx)(x.Zp,{children:(0,t.jsx)(x.Wu,{className:"py-12",children:(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"})})})})}):N?(0,t.jsx)(x.Zp,{children:(0,t.jsx)(x.Wu,{className:"py-12",children:(0,t.jsxs)("div",{className:"text-center text-red-500",children:[(0,t.jsx)(l.A,{className:"h-8 w-8 mx-auto mb-2"}),(0,t.jsx)("p",{children:"Failed to load family group"}),(0,t.jsx)("p",{className:"text-sm text-slate-500 mt-1",children:N.message})]})})}):e?(0,t.jsxs)("div",{className:"space-y-6",children:[(b||g)&&(0,t.jsx)(x.Zp,{className:"border-amber-500 dark:border-amber-600",children:(0,t.jsx)(x.Wu,{className:"py-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(l.A,{className:"h-5 w-5 text-amber-500"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-amber-700 dark:text-amber-400",children:g?"Group Frozen":"Grace Period Active"}),(0,t.jsx)("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:g?"This group is frozen because no owner has an active Pro subscription. Members cannot access shared content.":"All owners have lost Pro subscription. Group features will be frozen in 30 days unless Pro is restored."})]})]})})}),(0,t.jsxs)(x.Zp,{children:[(0,t.jsx)(x.aR,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(x.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(i.A,{className:"h-5 w-5"}),e.name]}),(0,t.jsxs)(x.BT,{children:["Your role:"," ",(0,t.jsx)("span",{className:"font-medium capitalize text-orange-500",children:a})]})]}),h&&(0,t.jsx)(u.$,{variant:"outline",size:"sm",asChild:!0,children:(0,t.jsxs)("a",{href:"/app/family/manage",children:[(0,t.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Manage"]})})]})}),(0,t.jsxs)(x.Wu,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,t.jsxs)("div",{className:"text-center p-4 rounded-xl bg-amber-50 dark:bg-amber-900/20",children:[(0,t.jsx)(c.A,{className:"h-5 w-5 mx-auto text-amber-500 mb-1"}),(0,t.jsx)("p",{className:"text-2xl font-bold",children:v}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"Owners"})]}),(0,t.jsxs)("div",{className:"text-center p-4 rounded-xl bg-blue-50 dark:bg-blue-900/20",children:[(0,t.jsx)(m.A,{className:"h-5 w-5 mx-auto text-blue-500 mb-1"}),(0,t.jsx)("p",{className:"text-2xl font-bold",children:y}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"Members"})]}),(0,t.jsxs)("div",{className:"text-center p-4 rounded-xl bg-slate-50 dark:bg-slate-800",children:[(0,t.jsx)(o.A,{className:"h-5 w-5 mx-auto text-slate-500 mb-1"}),(0,t.jsx)("p",{className:"text-2xl font-bold",children:w}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"Visitors"})]}),(0,t.jsxs)("div",{className:"text-center p-4 rounded-xl bg-orange-50 dark:bg-orange-900/20",children:[(0,t.jsx)(i.A,{className:"h-5 w-5 mx-auto text-orange-500 mb-1"}),(0,t.jsx)("p",{className:"text-2xl font-bold",children:k}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:"Pending"})]})]}),h&&(0,t.jsxs)("div",{className:"p-4 rounded-xl bg-slate-50 dark:bg-slate-800 mb-6",children:[(0,t.jsx)("p",{className:"text-sm text-slate-500 mb-1",children:"Invite Code"}),(0,t.jsx)("p",{className:"font-mono text-lg font-bold tracking-wider",children:e.inviteCode})]}),h&&(0,t.jsx)("div",{className:"flex flex-wrap gap-3",children:(0,t.jsxs)(u.$,{onClick:()=>A(!0),children:[(0,t.jsx)(n.A,{className:"h-4 w-4 mr-2"}),"Invite Member"]})})]})]}),(0,t.jsx)(B,{}),s.length>0&&(0,t.jsxs)(x.Zp,{children:[(0,t.jsxs)(x.aR,{children:[(0,t.jsxs)(x.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(o.A,{className:"h-5 w-5"}),"Other Groups"]}),(0,t.jsx)(x.BT,{children:"Groups you have visitor access to."})]}),(0,t.jsx)(x.Wu,{children:(0,t.jsx)("div",{className:"space-y-3",children:s.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-slate-50 dark:bg-slate-800",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-slate-500",children:["Joined ",new Date(e.joinedAt).toLocaleDateString()]})]}),(0,t.jsx)("span",{className:"px-2 py-1 text-xs rounded-full bg-slate-200 dark:bg-slate-700",children:"Visitor"})]},e.id))})})]}),(0,t.jsx)(ei,{open:C,onOpenChange:A})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(x.Zp,{children:[(0,t.jsxs)(x.aR,{children:[(0,t.jsxs)(x.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(i.A,{className:"h-5 w-5"}),"Family Group"]}),(0,t.jsx)(x.BT,{children:"Create a family group to share recipes, meal plans, and more with your family."})]}),(0,t.jsx)(x.Wu,{children:(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(i.A,{className:"h-16 w-16 mx-auto text-slate-300 dark:text-slate-700 mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"No Family Group Yet"}),(0,t.jsx)("p",{className:"text-slate-500 dark:text-slate-400 mb-6 max-w-md mx-auto",children:"Create a family group to invite family members and share your kitchen experience together. Pro subscription required."}),(0,t.jsxs)(u.$,{onClick:()=>F(!0),children:[(0,t.jsx)(n.A,{className:"h-4 w-4 mr-2"}),"Create Family Group"]})]})})]}),s.length>0&&(0,t.jsxs)(x.Zp,{children:[(0,t.jsxs)(x.aR,{children:[(0,t.jsxs)(x.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(o.A,{className:"h-5 w-5"}),"Groups You're Visiting"]}),(0,t.jsx)(x.BT,{children:"You have visitor access to these family groups."})]}),(0,t.jsx)(x.Wu,{children:(0,t.jsx)("div",{className:"space-y-3",children:s.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-slate-50 dark:bg-slate-800",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-slate-500",children:["Joined ",new Date(e.joinedAt).toLocaleDateString()]})]}),(0,t.jsx)("span",{className:"px-2 py-1 text-xs rounded-full bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-400",children:"Visitor"})]},e.id))})})]}),(0,t.jsx)(en,{open:R,onOpenChange:F})]})}var ed=a(7746),ec=a(97114),em=a(26219),ex=a(45074),eu=a(66141),ep=a(38268),eh=a(55092);let ef=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)(eh.bL,{className:(0,k.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-950 focus-visible:ring-offset-2 focus-visible:ring-offset-white disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-orange-500 data-[state=unchecked]:bg-slate-200 dark:focus-visible:ring-slate-300 dark:focus-visible:ring-offset-slate-950 dark:data-[state=checked]:bg-orange-500 dark:data-[state=unchecked]:bg-slate-800",e),...s,ref:a,children:(0,t.jsx)(eh.zi,{className:(0,k.cn)("pointer-events-none block h-5 w-5 rounded-full bg-white shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));ef.displayName=eh.bL.displayName;var eb=a(15885);let eg=["recipes","meal_history","shopping_lists","pantry","cooking_sessions","meal_plans"],ej={recipes:{name:"Recipes",description:"View and cook shared family recipes",icon:"book-open"},meal_history:{name:"Meal History",description:"View past meals cooked by family members",icon:"history"},shopping_lists:{name:"Shopping Lists",description:"View and edit shared shopping lists",icon:"shopping-cart"},pantry:{name:"Pantry",description:"View and manage shared pantry ingredients",icon:"package"},cooking_sessions:{name:"Cooking Sessions",description:"View active cooking sessions",icon:"flame"},meal_plans:{name:"Meal Plans",description:"View and edit weekly meal plans",icon:"calendar"}},eN={recipes:ed.A,meal_history:ec.A,shopping_lists:em.A,pantry:ex.A,cooking_sessions:eu.A,meal_plans:ep.A};function ev(){let{group:e}=(0,p.H)(),{features:s,canEdit:a,loading:l,actionLoading:i,togglePermission:n,enableAll:d,disableAll:c,memberSummary:h,visitorSummary:f}=function(e){let[s,a]=(0,r.useState)(null),[t,l]=(0,r.useState)(!1),[i,n]=(0,r.useState)(null),[o,d]=(0,r.useState)(!1),c=(0,r.useCallback)(async()=>{if(!e)return void a(null);try{l(!0),n(null);let s=await eb.api.getGroupPermissions(e);a(s)}catch(e){console.error("[useFamilyPermissions] Failed to fetch permissions:",e),n(e instanceof Error?e:Error("Failed to fetch permissions"))}finally{l(!1)}},[e]);(0,r.useEffect)(()=>{c()},[c]);let m=(0,r.useMemo)(()=>s?.features?s.features.map(e=>({key:e.key,name:e.name,description:e.description,icon:e.icon,memberAllowed:e.memberAllowed,visitorAllowed:e.visitorAllowed})):eg.map(e=>({key:e,...ej[e],memberAllowed:!1,visitorAllowed:!1})),[s]),x=s?.permissions||{member:{},visitor:{}},u=s?.userRole||null,p=s?.canEdit||!1,h=(0,r.useCallback)((e,s)=>x[s]?.[e]??!1,[x]),f=(0,r.useCallback)(e=>!!u&&("owner"===u||h(e,u)),[u,h]),b=(0,r.useCallback)(async(s,a,t)=>{if(!e)return{success:!1,error:"No group ID"};if(!p)return{success:!1,error:"Permission denied"};try{return d(!0),await eb.api.updateGroupPermissions(e,[{role:s,feature:a,allowed:t}]),await c(),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to update permission"}}finally{d(!1)}},[e,p,c]),g=(0,r.useCallback)(async s=>{if(!e)return{success:!1,error:"No group ID"};if(!p)return{success:!1,error:"Permission denied"};try{return d(!0),await eb.api.updateGroupPermissions(e,s),await c(),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Failed to update permissions"}}finally{d(!1)}},[e,p,c]),j=(0,r.useCallback)(async e=>g(eg.map(s=>({role:e,feature:s,allowed:!0}))),[g]),N=(0,r.useCallback)(async e=>g(eg.map(s=>({role:e,feature:s,allowed:!1}))),[g]),v=(0,r.useCallback)(e=>({enabled:eg.filter(s=>h(s,e)).length,total:eg.length}),[h]);return{features:m,permissions:x,userRole:u,canEdit:p,loading:t,actionLoading:o,error:i,isFeatureAllowed:h,canAccessFeature:f,refresh:c,togglePermission:b,updatePermissions:g,enableAll:j,disableAll:N,getSummary:v,memberSummary:v("member"),visitorSummary:v("visitor")}}(e?.id),[b,g]=(0,r.useState)(new Map);if(l)return(0,t.jsx)(x.Zp,{children:(0,t.jsx)(x.Wu,{className:"py-12",children:(0,t.jsx)("div",{className:"flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"})})})});if(!e)return(0,t.jsx)(x.Zp,{children:(0,t.jsx)(x.Wu,{className:"py-12 text-center text-slate-500",children:"No family group found"})});let j=async(e,s,a)=>{let t=await n(e,s,!a);t.success||console.error("Failed to update permission:",t.error)},N=async e=>{await d(e)},v=async e=>{await c(e)};return(0,t.jsxs)(x.Zp,{children:[(0,t.jsxs)(x.aR,{children:[(0,t.jsx)(x.ZB,{children:"Permission Settings"}),(0,t.jsx)(x.BT,{children:"Control what features members and visitors can access in your family group."})]}),(0,t.jsxs)(x.Wu,{children:[(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"border-b border-slate-200 dark:border-slate-800",children:[(0,t.jsx)("th",{className:"text-left py-3 pr-4 font-medium text-slate-500",children:"Feature"}),(0,t.jsxs)("th",{className:"text-center py-3 px-4 font-medium text-slate-500",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,t.jsx)(m.A,{className:"h-4 w-4 text-blue-500"}),(0,t.jsx)("span",{children:"Members"})]}),(0,t.jsxs)("span",{className:"text-xs font-normal",children:[h.enabled,"/",h.total," enabled"]})]}),(0,t.jsxs)("th",{className:"text-center py-3 pl-4 font-medium text-slate-500",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,t.jsx)(o.A,{className:"h-4 w-4 text-slate-400"}),(0,t.jsx)("span",{children:"Visitors"})]}),(0,t.jsxs)("span",{className:"text-xs font-normal",children:[f.enabled,"/",f.total," enabled"]})]})]})}),(0,t.jsx)("tbody",{children:s.map(e=>{let s=eN[e.key];return(0,t.jsxs)("tr",{className:"border-b border-slate-100 dark:border-slate-800 last:border-0",children:[(0,t.jsx)("td",{className:"py-4 pr-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 rounded-lg bg-slate-100 dark:bg-slate-800",children:(0,t.jsx)(s,{className:"h-4 w-4 text-slate-600 dark:text-slate-400"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-slate-500",children:e.description})]})]})}),(0,t.jsx)("td",{className:"py-4 px-4 text-center",children:a?(0,t.jsx)(ef,{checked:e.memberAllowed,onCheckedChange:()=>j("member",e.key,e.memberAllowed),disabled:i}):(0,t.jsx)("span",{className:`inline-flex items-center justify-center w-6 h-6 rounded-full ${e.memberAllowed?"bg-green-100 text-green-600 dark:bg-green-900/30":"bg-red-100 text-red-600 dark:bg-red-900/30"}`,children:e.memberAllowed?(0,t.jsx)(y.A,{className:"h-3 w-3"}):(0,t.jsx)(Y.A,{className:"h-3 w-3"})})}),(0,t.jsx)("td",{className:"py-4 pl-4 text-center",children:a?(0,t.jsx)(ef,{checked:e.visitorAllowed,onCheckedChange:()=>j("visitor",e.key,e.visitorAllowed),disabled:i}):(0,t.jsx)("span",{className:`inline-flex items-center justify-center w-6 h-6 rounded-full ${e.visitorAllowed?"bg-green-100 text-green-600 dark:bg-green-900/30":"bg-red-100 text-red-600 dark:bg-red-900/30"}`,children:e.visitorAllowed?(0,t.jsx)(y.A,{className:"h-3 w-3"}):(0,t.jsx)(Y.A,{className:"h-3 w-3"})})})]},e.key)})})]})}),a&&(0,t.jsxs)("div",{className:"mt-6 pt-6 border-t border-slate-200 dark:border-slate-800",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-slate-500 mb-3",children:"Quick Actions"}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-xs text-slate-400",children:"Members"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(u.$,{variant:"outline",size:"sm",onClick:()=>N("member"),disabled:i||h.enabled===h.total,children:"Enable All"}),(0,t.jsx)(u.$,{variant:"outline",size:"sm",onClick:()=>v("member"),disabled:i||0===h.enabled,children:"Disable All"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-xs text-slate-400",children:"Visitors"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(u.$,{variant:"outline",size:"sm",onClick:()=>N("visitor"),disabled:i||f.enabled===f.total,children:"Enable All"}),(0,t.jsx)(u.$,{variant:"outline",size:"sm",onClick:()=>v("visitor"),disabled:i||0===f.enabled,children:"Disable All"})]})]})]})]}),(0,t.jsx)("div",{className:"mt-6 p-4 rounded-xl bg-slate-50 dark:bg-slate-800/50",children:(0,t.jsxs)("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:[(0,t.jsx)("strong",{children:"Note:"})," Owners always have full access to all features. These settings only affect members and visitors."]})})]})]})}}}]);